"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6812],{6812:(Q,x,f)=>{f.r(x),f.d(x,{PostsPageModule:()=>B});var A=f(177),y=f(4341),h=f(3819),C=f(2146),d=f(467),o=f(4438),p=f(5083),b=function(c){return c.Prompt="PROMPT",c.Camera="CAMERA",c.Photos="PHOTOS",c}(b||{}),_=function(c){return c.Rear="REAR",c.Front="FRONT",c}(_||{}),R=function(c){return c.Uri="uri",c.Base64="base64",c.DataUrl="dataUrl",c}(R||{});class F extends p.E_{getPhoto(a){var l=this;return(0,d.A)(function*(){return new Promise(function(){var t=(0,d.A)(function*(e,n){if(a.webUseInput||a.source===b.Photos)l.fileInputExperience(a,e,n);else if(a.source===b.Prompt){let r=document.querySelector("pwa-action-sheet");r||(r=document.createElement("pwa-action-sheet"),document.body.appendChild(r)),r.header=a.promptLabelHeader||"Photo",r.cancelable=!1,r.options=[{title:a.promptLabelPhoto||"From Photos"},{title:a.promptLabelPicture||"Take Picture"}],r.addEventListener("onSelection",function(){var s=(0,d.A)(function*(u){0===u.detail?l.fileInputExperience(a,e,n):l.cameraExperience(a,e,n)});return function(u){return s.apply(this,arguments)}}())}else l.cameraExperience(a,e,n)});return function(e,n){return t.apply(this,arguments)}}())})()}pickImages(a){var l=this;return(0,d.A)(function*(){return new Promise(function(){var t=(0,d.A)(function*(e,n){l.multipleFileInputExperience(e,n)});return function(e,n){return t.apply(this,arguments)}}())})()}cameraExperience(a,l,t){var e=this;return(0,d.A)(function*(){if(customElements.get("pwa-camera-modal")){const n=document.createElement("pwa-camera-modal");n.facingMode=a.direction===_.Front?"user":"environment",document.body.appendChild(n);try{yield n.componentOnReady(),n.addEventListener("onPhoto",function(){var r=(0,d.A)(function*(s){const u=s.detail;null===u?t(new p.I9("User cancelled photos app")):u instanceof Error?t(u):l(yield e._getCameraPhoto(u,a)),n.dismiss(),document.body.removeChild(n)});return function(s){return r.apply(this,arguments)}}()),n.present()}catch{e.fileInputExperience(a,l,t)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),e.fileInputExperience(a,l,t)})()}fileInputExperience(a,l,t){let e=document.querySelector("#_capacitor-camera-input");const n=()=>{var r;null===(r=e.parentNode)||void 0===r||r.removeChild(e)};e||(e=document.createElement("input"),e.id="_capacitor-camera-input",e.type="file",e.hidden=!0,document.body.appendChild(e),e.addEventListener("change",r=>{const s=e.files[0];let u="jpeg";if("image/png"===s.type?u="png":"image/gif"===s.type&&(u="gif"),"dataUrl"===a.resultType||"base64"===a.resultType){const m=new FileReader;m.addEventListener("load",()=>{if("dataUrl"===a.resultType)l({dataUrl:m.result,format:u});else if("base64"===a.resultType){const g=m.result.split(",")[1];l({base64String:g,format:u})}n()}),m.readAsDataURL(s)}else l({webPath:URL.createObjectURL(s),format:u}),n()}),e.addEventListener("cancel",r=>{t(new p.I9("User cancelled photos app")),n()})),e.accept="image/*",e.capture=!0,a.source===b.Photos||a.source===b.Prompt?e.removeAttribute("capture"):a.direction===_.Front?e.capture="user":a.direction===_.Rear&&(e.capture="environment"),e.click()}multipleFileInputExperience(a,l){let t=document.querySelector("#_capacitor-camera-input-multiple");const e=()=>{var n;null===(n=t.parentNode)||void 0===n||n.removeChild(t)};t||(t=document.createElement("input"),t.id="_capacitor-camera-input-multiple",t.type="file",t.hidden=!0,t.multiple=!0,document.body.appendChild(t),t.addEventListener("change",n=>{const r=[];for(let s=0;s<t.files.length;s++){const u=t.files[s];let m="jpeg";"image/png"===u.type?m="png":"image/gif"===u.type&&(m="gif"),r.push({webPath:URL.createObjectURL(u),format:m})}a({photos:r}),e()}),t.addEventListener("cancel",n=>{l(new p.I9("User cancelled photos app")),e()})),t.accept="image/*",t.click()}_getCameraPhoto(a,l){return new Promise((t,e)=>{const n=new FileReader,r=a.type.split("/")[1];"uri"===l.resultType?t({webPath:URL.createObjectURL(a),format:r,saved:!1}):(n.readAsDataURL(a),n.onloadend=()=>{const s=n.result;t("dataUrl"===l.resultType?{dataUrl:s,format:r,saved:!1}:{base64String:s.split(",")[1],format:r,saved:!1})},n.onerror=s=>{e(s)})})}checkPermissions(){var a=this;return(0,d.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw a.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw a.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var a=this;return(0,d.A)(function*(){throw a.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var a=this;return(0,d.A)(function*(){throw a.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var a=this;return(0,d.A)(function*(){throw a.unavailable("Not implemented on web.")})()}}new F;const I=(0,p.F3)("Camera",{web:()=>new F});var i=f(163),M=f(4412),P=f(2107),G=f(8392),L=f(4857),S=f(7620),U=f(9974),O=f(4360),w=f(1985);let k=(()=>{var c;class a{constructor(t){this._firestore=t}addOne(t,e){return new Promise(n=>{let s,r=(0,i.rJ)(this._firestore,t);""==e.id||null==e.id||null==e.id?(s=(0,i.H9)(r),e.id=s.id):s=(0,i.H9)(r,e.id),(0,i.BN)(s,{...e},{merge:!0}),n(s)})}delete(t,e){var n=this;return(0,d.A)(function*(){return(0,i.kd)((0,i.H9)(n._firestore,t,e))})()}update(t,e){let n=(0,i.rJ)(this._firestore,t);const r=(0,i.H9)(n,e.id);return(0,i.mZ)(r,{...e})}getOne(t,e){let n=(0,i.rJ)(this._firestore,t);const r=(0,i.P)(n,(0,i._M)("id","==",e));return(0,i.GG)(r)}getOneObs(t,e){var n=this;return(0,d.A)(function*(){let r=(0,i.rJ)(n._firestore,t);const s=(0,i.P)(r,(0,i._M)("id","==",e),(0,i.AB)(1)),u=(yield(0,i.GG)(s)).docs[0].ref;return(0,i.Bg)(u)})()}getFirstQuery(t,e){let n=(0,i.P)((0,i.rJ)(this._firestore,t),e);return(0,i.GG)(n).then(r=>r.docs.map(s=>s.data())[0])}getAllQuery(t,e){var n=this;return(0,d.A)(function*(){let r=(0,i.P)((0,i.rJ)(n._firestore,t),e);return(yield(0,i.GG)(r)).docs.map(u=>u.data())})()}getAllQueryObs(t,e,n=""){let r;return r=n?(0,i.P)((0,i.rJ)(this._firestore,t),e,(0,i.My)(n)):(0,i.P)((0,i.rJ)(this._firestore,t),e),(0,i.xs)(r)}getAll(t){var e=this;return(0,d.A)(function*(){let n=(0,i.rJ)(e._firestore,t);return(yield(0,i.GG)(n)).docs.map(s=>s.data())})()}getAllObs(t){let e=(0,i.rJ)(this._firestore,t);return(0,i.xs)(e)}getAllWhere(t,e,n){var r=this;return(0,d.A)(function*(){let s=(0,i.P)((0,i.rJ)(r._firestore,t),(0,i._M)(e,"==",n));return(yield(0,i.GG)(s)).docs.map(m=>m.data())})()}getAllWhereObs(t,e,n){let r=(0,i.P)((0,i.rJ)(this._firestore,t),(0,i._M)(e,"==",n));return(0,i.xs)(r)}exists(t,e,n){var r=this;return(0,d.A)(function*(){let s=(0,i.P)((0,i.rJ)(r._firestore,t),(0,i._M)(e,"==",n));return!(yield(0,i.GG)(s)).empty})()}existsObs(t,e,n){let r=(0,i.P)((0,i.rJ)(this._firestore,t),(0,i._M)(e,"==",n));return(0,i.E$)(r).pipe(function j(c,a){return(0,U.N)((l,t)=>{let e=0;l.subscribe((0,O._)(t,n=>{c.call(a,n,e++,l)||(t.next(!1),t.complete())},()=>{t.next(!0),t.complete()}))})}(s=>s>0))}existsQuery(t,e){var n=this;return(0,d.A)(function*(){let r=(0,i.P)((0,i.rJ)(n._firestore,t),e);return!(yield(0,i.GG)(r)).empty})()}getAllWhereSnapshot(t,e,n,r){let s=(0,i.P)((0,i.rJ)(this._firestore,t),e,(0,i.My)(n,r));return new w.c(u=>{const m=(0,i.aQ)(s,g=>{const v=[];g.forEach(X=>{const $={...X.data()};v.push($)}),u.next(v)});return()=>m()})}getAllSnapshot(t){let e=(0,i.P)((0,i.rJ)(this._firestore,t),(0,i.My)("name","asc"));return new w.c(n=>{(0,i.aQ)(e,s=>{const u=[];s.forEach(m=>{const g={...m.data()};u.push(g)}),n.next(u)})})}getOneByValue(t,e,n){let r=(0,i.rJ)(this._firestore,t);const s=(0,i.P)(r,(0,i._M)(e,"==",n));return(0,i.GG)(s)}getOneByValue2(t,e,n){var r=this;return(0,d.A)(function*(){let s=(0,i.rJ)(r._firestore,t);const u=(0,i.P)(s,(0,i._M)(e,"==",n)),m=yield(0,i.GG)(u);if(!m.empty)return m.docs[0].data()})()}}return(c=a).\u0275fac=function(t){return new(t||c)(o.KVO(i._7))},c.\u0275prov=o.jDH({token:c,factory:c.\u0275fac,providedIn:"root"}),a})();var E=f(9610);function N(c,a){1&c&&(o.j41(0,"div",16),o.nrm(1,"ion-spinner",17),o.k0s())}function D(c,a){1&c&&(o.j41(0,"div",16),o.nrm(1,"ion-spinner",17),o.k0s())}function J(c,a){if(1&c){const l=o.RV6();o.j41(0,"div",6)(1,"div",7),o.DNE(2,N,2,0,"div",8),o.j41(3,"div",9),o.DNE(4,D,2,0,"div",8),o.j41(5,"ion-img",10),o.bIt("ionImgDidLoad",function(){o.eBV(l);const e=o.XpG();return o.Njj(e.flagImagenCargo=!0)})("ionError",function(){o.eBV(l);const e=o.XpG();return o.Njj(e.imagenNoCargo())}),o.k0s()(),o.j41(6,"div",11)(7,"ion-input",12),o.mxI("ngModelChange",function(e){o.eBV(l);const n=o.XpG();return o.DH7(n.comentario,e)||(n.comentario=e),o.Njj(e)}),o.k0s()(),o.j41(8,"div",13)(9,"ion-button",14),o.bIt("click",function(){o.eBV(l);const e=o.XpG();return o.Njj(e.nuevoPost())}),o.EFF(10,"Confirmar"),o.k0s(),o.j41(11,"ion-button",15),o.bIt("click",function(){o.eBV(l);const e=o.XpG();return o.Njj(e.finalizarSubida())}),o.EFF(12,"Cancelar"),o.k0s()()()()}if(2&c){const l=o.XpG();o.R7$(2),o.Y8G("ngIf",l.loadingSubiendoFoto),o.R7$(2),o.Y8G("ngIf",!l.flagImagenCargo),o.R7$(),o.Y8G("src",null==l.nuevoPostImagen?null:l.nuevoPostImagen.webPath),o.R7$(2),o.R50("ngModel",l.comentario)}}const T=[{path:"",component:(()=>{var c;class a{constructor(t,e,n,r,s){this._servicioCompartido=t,this.authServ=e,this.chRef=n,this.activeRoute=r,this.firestoreServ=s,this.firestore=(0,o.WQX)(i._7),this.storage=(0,o.WQX)(P.wc),this.nuevoPostImagen=void 0,this.comentario="",this.verVentanaConfirmacion=new M.t(!1),this.flagImagenCargo=!1,this.loadingSubiendoFoto=!1,r.paramMap.subscribe(u=>{if(u.has("category")){let g="";switch(u.get("category")){case"lindas":g="cosas_lindas";break;case"feas":g="cosas_feas"}this.publicacionesCollection=(0,i.rJ)(this.firestore,"posts/"+g+"/publicaciones");const v=(0,i.P)(this.publicacionesCollection,(0,i.My)("fecha","desc"));this.publicaciones$=(0,i.xs)(v,{idField:"idDoc"})}}),(0,G.hg)(e.getAuth(),u=>{const m=(0,i.rJ)(this.firestore,"datos_usuarios/"+(null==u?void 0:u.uid)+"/posts_favoritos");(0,i.GG)(m).then(g=>{this.favoritos=g.docs.map(v=>({id:v.id,likeado:v.data().likeado}))})})}ngOnInit(){this.verVentanaConfirmacion.subscribe(()=>{this.chRef.detectChanges()})}ventanaConfirmacion(){this.verVentanaConfirmacion.next(!this.verVentanaConfirmacion.getValue())}nuevoPost(){var t=this;return(0,d.A)(function*(){yield t.subirFoto(t.nuevoPostImagen),t.finalizarSubida()})()}tomarFoto(){var t=this;return(0,d.A)(function*(){p.Ii.isPluginAvailable("Camera")||!p.Ii.isNativePlatform()?I.getPhoto({quality:60,resultType:R.Uri}).then(e=>{t.nuevoPostImagen=e,t.ventanaConfirmacion(),t.chRef.detectChanges()}).catch(e=>{console.log(e)}):t._servicioCompartido.mensajeError("Error al abrir la camara")})()}subirFoto(t){var e=this;return(0,d.A)(function*(){var n;if(null!==(n=e.authServ.userLogged)&&void 0!==n&&n.displayName&&t&&e.publicacionesCollection){var r,s;e.loadingSubiendoFoto=!0,console.time("subiendo al storage"),console.timeLog("subiendo al storage");let m=yield e.subirArchivoStorage(t);console.timeEnd("subiendo al storage"),yield(0,i.gS)(e.publicacionesCollection,{comentario:e.comentario,imagenUrl:m,fecha:Date.now(),user:{displayName:null!==(r=null!==(s=e.authServ.userLogged.displayName)&&void 0!==s?s:e.authServ.userLogged.email)&&void 0!==r?r:"Guest"+1e3*Math.random(),uid:e.authServ.userLogged.uid},conteoFav:0,listadoUsuariosFav:[]}).then(g=>{(0,i.mZ)(g,{idDoc:g.id})}),e.loadingSubiendoFoto=!1}else{var u;alert(null===(u=e.authServ.userLogged)||void 0===u?void 0:u.email),alert(t),e._servicioCompartido.mensajeError("Error al subir foto"),e.finalizarSubida()}})()}subirArchivoStorage(t){var e=this;return(0,d.A)(function*(){const r=yield(yield fetch(t.webPath)).blob(),s="imagenes/cosas_feas/"+Date.now()+".jpeg",u=(0,P.KR)(e.storage,s);return console.time("subiendo"),console.timeLog("subiendo"),yield(0,P.bp)(u,r),console.timeEnd("subiendo"),(0,P.qk)(u)})()}finalizarSubida(){this.ventanaConfirmacion(),this.flagImagenCargo=!1,this.nuevoPostImagen=void 0,this.chRef.detectChanges()}uriImagenStorage(t){var e=this;return(0,d.A)(function*(){const n=(0,P.KR)(e.storage,t);return yield(0,P.qk)(n)})()}imagenNoCargo(){var t=this;return(0,d.A)(function*(){t._servicioCompartido.mensajeError("Error al cargar la imagen")})()}darLike(t){var e=this;return(0,d.A)(function*(){var n;if(null===(n=e.authServ.userLogged)||void 0===n||!n.email)return;let r=t.listadoUsuariosFav;if(e.tieneLike(t)){t.conteoFav=t.conteoFav-1;const s=r.indexOf(e.authServ.userLogged.email);r.splice(s,1)}else r.push(e.authServ.userLogged.email),t.conteoFav=t.conteoFav+1;if(e.publicacionesCollection){const s=(0,i.H9)(e.publicacionesCollection,t.idDoc);(0,i.mZ)(s,{conteoFav:t.conteoFav,listadoUsuariosFav:r})}})()}tieneLike(t){var e,n;return t.listadoUsuariosFav.includes(null!==(e=null===(n=this.authServ.userLogged)||void 0===n?void 0:n.email)&&void 0!==e?e:"")}}return(c=a).\u0275fac=function(t){return new(t||c)(o.rXU(L.c),o.rXU(S.F),o.rXU(o.gRc),o.rXU(C.nX),o.rXU(k))},c.\u0275cmp=o.VBU({type:c,selectors:[["app-posts"]],decls:6,vars:4,consts:[[3,"fullscreen"],[3,"publicaciones$"],["class","container-fondo",4,"ngIf"],["slot","fixed","vertical","bottom","horizontal","end"],[3,"click","disabled"],["name","add-outline"],[1,"container-fondo"],[1,"container-confirmacion","center"],["class","spinner",4,"ngIf"],[1,"cuadro-imagen-confirmacion"],[1,"imagen-subida",3,"ionImgDidLoad","ionError","src"],[1,"cuadro-texto-confirmacion"],["label","Comentario (opcional)","labelPlacement","stacked",3,"ngModelChange","ngModel"],[1,"cuadro-botones-confirmacion"],[3,"click"],["color","danger",3,"click"],[1,"spinner"],["name","dots"]],template:function(t,e){1&t&&(o.j41(0,"ion-content",0),o.nrm(1,"app-listado-posteos",1),o.DNE(2,J,13,4,"div",2),o.j41(3,"ion-fab",3)(4,"ion-fab-button",4),o.bIt("click",function(){return e.tomarFoto()}),o.nrm(5,"ion-icon",5),o.k0s()()()),2&t&&(o.Y8G("fullscreen",!0),o.R7$(),o.Y8G("publicaciones$",e.publicaciones$),o.R7$(),o.Y8G("ngIf",e.verVentanaConfirmacion.getValue()),o.R7$(2),o.Y8G("disabled",e.verVentanaConfirmacion.getValue()))},dependencies:[A.bT,y.BC,y.vS,h.Jm,h.W9,h.Q8,h.YW,h.iq,h.KW,h.$w,h.w2,h.Gw,E.F],styles:[".container-fondo[_ngcontent-%COMP%]{position:fixed;top:0;left:0;z-index:100;width:100vw;height:100vh;background-color:#80808080}.container-confirmacion[_ngcontent-%COMP%]{width:90%;height:auto;max-width:25rem;padding:.5rem;background-color:color-mix(in srgb,var(--ion-background-color),#000dff 25%);box-shadow:0 0 12px var(--ion-background-color-step-950)}.cuadro-imagen-confirmacion[_ngcontent-%COMP%]{position:sticky}.cuadro-imagen-confirmacion[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{outline:.01rem solid rgb(0,0,0);margin:auto;margin-top:.7rem}.cuadro-imagen-confirmacion[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]::part(image){max-height:14rem}.imagen-subida[_ngcontent-%COMP%]{max-width:25rem;height:auto}.cuadro-botones-confirmacion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;max-width:100%}.listado-posteos[_ngcontent-%COMP%]{margin:1rem auto;width:90%;max-width:35rem}"],changeDetection:0}),a})()}];let V=(()=>{var c;class a{}return(c=a).\u0275fac=function(t){return new(t||c)},c.\u0275mod=o.$C({type:c}),c.\u0275inj=o.G2t({imports:[C.iI.forChild(T),C.iI]}),a})(),B=(()=>{var c;class a{}return(c=a).\u0275fac=function(t){return new(t||c)},c.\u0275mod=o.$C({type:c}),c.\u0275inj=o.G2t({imports:[A.MD,y.YN,h.bv,V,E.F]}),a})()}}]);
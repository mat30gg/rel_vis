"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6598],{6598:(V,C,s)=>{s.r(C),s.d(C,{CosasFeasPageModule:()=>E});var b=s(177),h=s(4341),d=s(3819),p=s(2146),m=s(467),o=s(4438),F=s(7691),P=s(5083),c=s(163),j=s(4412),v=s(2107),M=s(8392),R=s(4857),y=s(7620),_=s(8994);function S(a,l){1&a&&(o.j41(0,"div",16),o.nrm(1,"ion-spinner",17),o.k0s())}function x(a,l){1&a&&(o.j41(0,"div",16),o.nrm(1,"ion-spinner",17),o.k0s())}function G(a,l){if(1&a){const t=o.RV6();o.j41(0,"div",6)(1,"div",7),o.DNE(2,S,2,0,"div",8),o.j41(3,"div",9),o.DNE(4,x,2,0,"div",8),o.j41(5,"ion-img",10),o.bIt("ionImgDidLoad",function(){o.eBV(t);const e=o.XpG();return o.Njj(e.flagImagenCargo=!0)})("ionError",function(){o.eBV(t);const e=o.XpG();return o.Njj(e.imagenNoCargo)}),o.k0s()(),o.j41(6,"div",11)(7,"ion-input",12),o.mxI("ngModelChange",function(e){o.eBV(t);const i=o.XpG();return o.DH7(i.comentario,e)||(i.comentario=e),o.Njj(e)}),o.k0s()(),o.j41(8,"div",13)(9,"ion-button",14),o.bIt("click",function(){o.eBV(t);const e=o.XpG();return o.Njj(e.nuevoPost())}),o.EFF(10,"Confirmar"),o.k0s(),o.j41(11,"ion-button",15),o.bIt("click",function(){o.eBV(t);const e=o.XpG();return o.Njj(e.finalizarSubida())}),o.EFF(12,"Cancelar"),o.k0s()()()()}if(2&a){const t=o.XpG();o.R7$(2),o.Y8G("ngIf",t.loadingSubiendoFoto),o.R7$(2),o.Y8G("ngIf",!t.flagImagenCargo),o.R7$(),o.Y8G("src",null==t.nuevoPostImagen?null:t.nuevoPostImagen.webPath),o.R7$(2),o.R50("ngModel",t.comentario)}}const L=[{path:"",component:(()=>{var a;class l{constructor(n,e,i){this._servicioCompartido=n,this.authServ=e,this.chRef=i,this.firestore=(0,o.WQX)(c._7),this.storage=(0,o.WQX)(v.wc),this.nuevoPostImagen=void 0,this.comentario="",this.verVentanaConfirmacion=new j.t(!1),this.flagImagenCargo=!1,this.loadingSubiendoFoto=!1,this.publicacionesCollection=(0,c.rJ)(this.firestore,"posts/cosas_feas/publicaciones");const r=(0,c.P)(this.publicacionesCollection,(0,c.My)("fecha","desc"));this.publicaciones$=(0,c.xs)(r,{idField:"idDoc"}),(0,M.hg)(e.getAuth(),u=>{const g=(0,c.rJ)(this.firestore,"datos_usuarios/"+(null==u?void 0:u.uid)+"/posts_favoritos");(0,c.GG)(g).then(f=>{this.favoritos=f.docs.map(I=>({id:I.id,likeado:I.data().likeado})),console.log(f)})})}ngOnInit(){this.verVentanaConfirmacion.subscribe(()=>{this.chRef.detectChanges()})}ventanaConfirmacion(){this.verVentanaConfirmacion.next(!this.verVentanaConfirmacion.getValue())}nuevoPost(){var n=this;return(0,m.A)(function*(){yield n.subirFoto(n.nuevoPostImagen),n.finalizarSubida()})()}tomarFoto(){var n=this;return(0,m.A)(function*(){P.Ii.isPluginAvailable("Camera")||!P.Ii.isNativePlatform()?F.i7.getPhoto({quality:60,resultType:F.LK.Uri}).then(e=>{n.nuevoPostImagen=e,n.ventanaConfirmacion(),n.chRef.detectChanges()}).catch(e=>{console.log(e)}):n._servicioCompartido.mensajeError("Error al abrir la camara")})()}subirFoto(n){var e=this;return(0,m.A)(function*(){var i;if(null!==(i=e.authServ.userLogged)&&void 0!==i&&i.email&&n){var r;e.loadingSubiendoFoto=!0,console.time("subiendo al storage"),console.timeLog("subiendo al storage");let g=yield e.subirArchivoStorage(n);console.timeEnd("subiendo al storage"),yield(0,c.gS)(e.publicacionesCollection,{comentario:e.comentario,imagenUrl:g,fecha:Date.now(),usuario:null===(r=e.authServ.userLogged)||void 0===r?void 0:r.email,conteoFav:0,listadoUsuariosFav:[]}).then(f=>{(0,c.mZ)(f,{idDoc:f.id})}),e.loadingSubiendoFoto=!1}else{var u;alert(null===(u=e.authServ.userLogged)||void 0===u?void 0:u.email),alert(n),e._servicioCompartido.mensajeError("Error al subir foto"),e.finalizarSubida()}})()}subirArchivoStorage(n){var e=this;return(0,m.A)(function*(){const r=yield(yield fetch(n.webPath)).blob(),u="imagenes/cosas_feas/"+Date.now()+".jpeg",g=(0,v.KR)(e.storage,u);return console.time("subiendo"),console.timeLog("subiendo"),yield(0,v.bp)(g,r),console.timeEnd("subiendo"),(0,v.qk)(g)})()}finalizarSubida(){this.ventanaConfirmacion(),this.flagImagenCargo=!1,this.nuevoPostImagen=void 0,this.chRef.detectChanges()}uriImagenStorage(n){var e=this;return(0,m.A)(function*(){const i=(0,v.KR)(e.storage,n);return yield(0,v.qk)(i)})()}imagenNoCargo(){var n=this;return(0,m.A)(function*(){n._servicioCompartido.mensajeError("Error al cargar la imagen")})()}darLike(n){var e=this;return(0,m.A)(function*(){var i;if(null===(i=e.authServ.userLogged)||void 0===i||!i.email)return;let r=n.listadoUsuariosFav;if(e.tieneLike(n)){n.conteoFav=n.conteoFav-1;const g=r.indexOf(e.authServ.userLogged.email);r.splice(g,1)}else r.push(e.authServ.userLogged.email),n.conteoFav=n.conteoFav+1;const u=(0,c.H9)(e.publicacionesCollection,n.idDoc);(0,c.mZ)(u,{conteoFav:n.conteoFav,listadoUsuariosFav:r})})()}tieneLike(n){var e,i;return n.listadoUsuariosFav.includes(null!==(e=null===(i=this.authServ.userLogged)||void 0===i?void 0:i.email)&&void 0!==e?e:"")}}return(a=l).\u0275fac=function(n){return new(n||a)(o.rXU(R.c),o.rXU(y.F),o.rXU(o.gRc))},a.\u0275cmp=o.VBU({type:a,selectors:[["app-cosas-feas"]],decls:6,vars:4,consts:[[3,"fullscreen"],[3,"publicaciones$"],["class","container-fondo",4,"ngIf"],["slot","fixed","vertical","bottom","horizontal","end"],[3,"click","disabled"],["name","add-outline"],[1,"container-fondo"],[1,"container-confirmacion","center"],["class","spinner",4,"ngIf"],[1,"cuadro-imagen-confirmacion"],[1,"imagen-subida",3,"ionImgDidLoad","ionError","src"],[1,"cuadro-texto-confirmacion"],["label","Comentario (opcional)","labelPlacement","stacked",3,"ngModelChange","ngModel"],[1,"cuadro-botones-confirmacion"],[3,"click"],["color","danger",3,"click"],[1,"spinner"],["name","dots"]],template:function(n,e){1&n&&(o.j41(0,"ion-content",0),o.nrm(1,"app-listado-posteos",1),o.DNE(2,G,13,4,"div",2),o.j41(3,"ion-fab",3)(4,"ion-fab-button",4),o.bIt("click",function(){return e.tomarFoto()}),o.nrm(5,"ion-icon",5),o.k0s()()()),2&n&&(o.Y8G("fullscreen",!0),o.R7$(),o.Y8G("publicaciones$",e.publicaciones$),o.R7$(),o.Y8G("ngIf",e.verVentanaConfirmacion.getValue()),o.R7$(2),o.Y8G("disabled",e.verVentanaConfirmacion.getValue()))},dependencies:[b.bT,h.BC,h.vS,d.Jm,d.W9,d.Q8,d.YW,d.iq,d.KW,d.$w,d.w2,d.Gw,_.F],styles:[".container-fondo[_ngcontent-%COMP%]{position:fixed;top:0;left:0;z-index:100;width:100vw;height:100vh;background-color:#80808080}.container-confirmacion[_ngcontent-%COMP%]{width:90%;height:auto;max-width:25rem;padding:.5rem;background-color:var(--ion-color-dark)}.cuadro-imagen-confirmacion[_ngcontent-%COMP%]{margin:.5rem auto 1rem;position:sticky}.cuadro-imagen-confirmacion[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{outline:.01rem solid rgb(0,0,0);margin:auto;margin-top:.7rem;margin-bottom:1.4rem}.cuadro-imagen-confirmacion[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]::part(image){max-height:14rem}.imagen-subida[_ngcontent-%COMP%]{max-width:25rem;height:auto}.cuadro-texto-confirmacion[_ngcontent-%COMP%]{margin:1rem auto}.cuadro-botones-confirmacion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:1rem auto .5rem;max-width:100%}.listado-posteos[_ngcontent-%COMP%]{margin:1rem auto;width:90%;max-width:35rem}"],changeDetection:0}),l})()}];let k=(()=>{var a;class l{}return(a=l).\u0275fac=function(n){return new(n||a)},a.\u0275mod=o.$C({type:a}),a.\u0275inj=o.G2t({imports:[p.iI.forChild(L),p.iI]}),l})(),E=(()=>{var a;class l{}return(a=l).\u0275fac=function(n){return new(n||a)},a.\u0275mod=o.$C({type:a}),a.\u0275inj=o.G2t({imports:[b.MD,h.YN,d.bv,k,_.F]}),l})()}}]);
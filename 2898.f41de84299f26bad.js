"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2898],{2898:(V,C,s)=>{s.r(C),s.d(C,{CosasLindasPageModule:()=>E});var b=s(177),h=s(4341),u=s(3819),p=s(2146),m=s(467),o=s(4438),P=s(7691),L=s(5083),c=s(163),I=s(4412),v=s(2107),j=s(8392),M=s(4857),R=s(7620),_=s(8994);function y(e,l){1&e&&(o.j41(0,"div",16),o.nrm(1,"ion-spinner",17),o.k0s())}function S(e,l){1&e&&(o.j41(0,"div",16),o.nrm(1,"ion-spinner",17),o.k0s())}function x(e,l){if(1&e){const t=o.RV6();o.j41(0,"div",6)(1,"div",7),o.DNE(2,y,2,0,"div",8),o.j41(3,"div",9),o.DNE(4,S,2,0,"div",8),o.j41(5,"ion-img",10),o.bIt("ionImgDidLoad",function(){o.eBV(t);const n=o.XpG();return o.Njj(n.flagImagenCargo=!0)})("ionError",function(){o.eBV(t);const n=o.XpG();return o.Njj(n.imagenNoCargo)}),o.k0s()(),o.j41(6,"div",11)(7,"ion-input",12),o.mxI("ngModelChange",function(n){o.eBV(t);const a=o.XpG();return o.DH7(a.comentario,n)||(a.comentario=n),o.Njj(n)}),o.k0s()(),o.j41(8,"div",13)(9,"ion-button",14),o.bIt("click",function(){o.eBV(t);const n=o.XpG();return o.Njj(n.nuevoPost())}),o.EFF(10,"Confirmar"),o.k0s(),o.j41(11,"ion-button",15),o.bIt("click",function(){o.eBV(t);const n=o.XpG();return o.Njj(n.finalizarSubida())}),o.EFF(12,"Cancelar"),o.k0s()()()()}if(2&e){const t=o.XpG();o.R7$(2),o.Y8G("ngIf",t.loadingSubiendoFoto),o.R7$(2),o.Y8G("ngIf",!t.flagImagenCargo),o.R7$(),o.Y8G("src",null==t.nuevoPostImagen?null:t.nuevoPostImagen.webPath),o.R7$(2),o.R50("ngModel",t.comentario)}}const G=[{path:"",component:(()=>{var e;class l{constructor(i,n,a){this._servicioCompartido=i,this.authServ=n,this.chRef=a,this.firestore=(0,o.WQX)(c._7),this.storage=(0,o.WQX)(v.wc),this.nuevoPostImagen=void 0,this.comentario="",this.verVentanaConfirmacion=new I.t(!1),this.flagImagenCargo=!1,this.loadingSubiendoFoto=!1,this.publicacionesCollection=(0,c.rJ)(this.firestore,"posts/cosas_lindas/publicaciones");const r=(0,c.P)(this.publicacionesCollection,(0,c.My)("fecha","desc"));this.publicaciones$=(0,c.xs)(r,{idField:"idDoc"}),(0,j.hg)(n.getAuth(),d=>{const g=(0,c.rJ)(this.firestore,"datos_usuarios/"+(null==d?void 0:d.uid)+"/posts_favoritos");(0,c.GG)(g).then(f=>{this.favoritos=f.docs.map(F=>({id:F.id,likeado:F.data().likeado})),console.log(f)})})}ngOnInit(){this.verVentanaConfirmacion.subscribe(i=>{this.chRef.detectChanges()})}ventanaConfirmacion(){this.verVentanaConfirmacion.next(!this.verVentanaConfirmacion.getValue())}nuevoPost(){var i=this;return(0,m.A)(function*(){yield i.subirFoto(i.nuevoPostImagen),i.finalizarSubida()})()}tomarFoto(){var i=this;return(0,m.A)(function*(){L.Ii.isPluginAvailable("Camera")||!L.Ii.isNativePlatform()?P.i7.getPhoto({quality:60,resultType:P.LK.Uri}).then(n=>{i.nuevoPostImagen=n,i.ventanaConfirmacion(),i.chRef.detectChanges()}).catch(n=>{console.log(n)}):i._servicioCompartido.mensajeError("Error al abrir la camara")})()}subirFoto(i){var n=this;return(0,m.A)(function*(){var a;if(null!==(a=n.authServ.userLogged)&&void 0!==a&&a.email&&i){var r;n.loadingSubiendoFoto=!0,console.time("subiendo al storage"),console.timeLog("subiendo al storage");let g=yield n.subirArchivoStorage(i);console.timeEnd("subiendo al storage"),yield(0,c.gS)(n.publicacionesCollection,{comentario:n.comentario,imagenUrl:g,fecha:Date.now(),usuario:null===(r=n.authServ.userLogged)||void 0===r?void 0:r.email,conteoFav:0,listadoUsuariosFav:[]}).then(f=>{(0,c.mZ)(f,{idDoc:f.id})}),n.loadingSubiendoFoto=!1}else{var d;alert(null===(d=n.authServ.userLogged)||void 0===d?void 0:d.email),alert(i),n._servicioCompartido.mensajeError("Error al subir foto"),n.finalizarSubida()}})()}subirArchivoStorage(i){var n=this;return(0,m.A)(function*(){const r=yield(yield fetch(i.webPath)).blob(),d="imagenes/cosas_lindas/"+Date.now()+".jpeg",g=(0,v.KR)(n.storage,d);return console.time("subiendo"),console.timeLog("subiendo"),yield(0,v.bp)(g,r),console.timeEnd("subiendo"),(0,v.qk)(g)})()}finalizarSubida(){this.ventanaConfirmacion(),this.flagImagenCargo=!1,this.nuevoPostImagen=void 0,this.comentario="",this.chRef.detectChanges()}uriImagenStorage(i){var n=this;return(0,m.A)(function*(){const a=(0,v.KR)(n.storage,i);return yield(0,v.qk)(a)})()}imagenNoCargo(){var i=this;return(0,m.A)(function*(){i._servicioCompartido.mensajeError("Error al cargar la imagen")})()}darLike(i){var n=this;return(0,m.A)(function*(){var a;if(null===(a=n.authServ.userLogged)||void 0===a||!a.email)return;let r=i.listadoUsuariosFav;if(n.tieneLike(i)){i.conteoFav=i.conteoFav-1;const g=r.indexOf(n.authServ.userLogged.email);r.splice(g,1)}else r.push(n.authServ.userLogged.email),i.conteoFav=i.conteoFav+1;const d=(0,c.H9)(n.publicacionesCollection,i.idDoc);(0,c.mZ)(d,{conteoFav:i.conteoFav,listadoUsuariosFav:r})})()}tieneLike(i){var n,a;return i.listadoUsuariosFav.includes(null!==(n=null===(a=this.authServ.userLogged)||void 0===a?void 0:a.email)&&void 0!==n?n:"")}}return(e=l).\u0275fac=function(i){return new(i||e)(o.rXU(M.c),o.rXU(R.F),o.rXU(o.gRc))},e.\u0275cmp=o.VBU({type:e,selectors:[["app-cosas-lindas"]],decls:6,vars:4,consts:[[3,"fullscreen"],[3,"publicaciones$"],["class","container-fondo",4,"ngIf"],["slot","fixed","vertical","bottom","horizontal","end"],[3,"click","disabled"],["name","add-outline"],[1,"container-fondo"],[1,"container-confirmacion","center"],["class","spinner",4,"ngIf"],[1,"cuadro-imagen-confirmacion"],[1,"imagen-subida",3,"ionImgDidLoad","ionError","src"],[1,"cuadro-texto-confirmacion"],["label","Comentario (opcional)","labelPlacement","stacked",3,"ngModelChange","ngModel"],[1,"cuadro-botones-confirmacion"],[3,"click"],["color","danger",3,"click"],[1,"spinner"],["name","dots"]],template:function(i,n){1&i&&(o.j41(0,"ion-content",0),o.nrm(1,"app-listado-posteos",1),o.DNE(2,x,13,4,"div",2),o.j41(3,"ion-fab",3)(4,"ion-fab-button",4),o.bIt("click",function(){return n.tomarFoto()}),o.nrm(5,"ion-icon",5),o.k0s()()()),2&i&&(o.Y8G("fullscreen",!0),o.R7$(),o.Y8G("publicaciones$",n.publicaciones$),o.R7$(),o.Y8G("ngIf",n.verVentanaConfirmacion.getValue()),o.R7$(2),o.Y8G("disabled",n.verVentanaConfirmacion.getValue()))},dependencies:[b.bT,h.BC,h.vS,u.Jm,u.W9,u.Q8,u.YW,u.iq,u.KW,u.$w,u.w2,u.Gw,_.F],styles:[".container-fondo[_ngcontent-%COMP%]{position:fixed;top:0;left:0;z-index:100;width:100vw;height:100vh;background-color:#80808080}.container-confirmacion[_ngcontent-%COMP%]{width:90%;height:auto;max-width:25rem;padding:.5rem;background-color:var(--ion-color-dark)}.cuadro-imagen-confirmacion[_ngcontent-%COMP%]{margin:.5rem auto 1rem;position:sticky}.cuadro-imagen-confirmacion[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{outline:.01rem solid rgb(0,0,0);margin:auto;margin-top:.7rem;margin-bottom:1.4rem}.cuadro-imagen-confirmacion[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]::part(image){max-height:14rem}.imagen-subida[_ngcontent-%COMP%]{max-width:25rem;height:auto}.cuadro-texto-confirmacion[_ngcontent-%COMP%]{margin:1rem auto}.cuadro-botones-confirmacion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:1rem auto .5rem;max-width:100%}.listado-posteos[_ngcontent-%COMP%]{margin:1rem auto;width:90%;max-width:35rem}"],changeDetection:0}),l})()}];let k=(()=>{var e;class l{}return(e=l).\u0275fac=function(i){return new(i||e)},e.\u0275mod=o.$C({type:e}),e.\u0275inj=o.G2t({imports:[p.iI.forChild(G),p.iI]}),l})(),E=(()=>{var e;class l{}return(e=l).\u0275fac=function(i){return new(i||e)},e.\u0275mod=o.$C({type:e}),e.\u0275inj=o.G2t({imports:[b.MD,h.YN,u.bv,k,_.F]}),l})()}}]);